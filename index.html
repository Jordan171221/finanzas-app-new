<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1f36">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Finanzas">
    
    <title>ğŸ’° Finanzas App</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Cargando...</p>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="auth-screen" style="display: none;">
        <div class="auth-container">
            <div class="auth-logo">ğŸ’°</div>
            <h1 class="auth-title">Finanzas App</h1>
            <p class="auth-subtitle">Inicia sesiÃ³n para continuar</p>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Usuario</label>
                    <input type="text" id="loginUsername" required placeholder="Ej: jmorales08">
                </div>

                <div class="form-group">
                    <label>ContraseÃ±a</label>
                    <input type="password" id="loginPassword" required placeholder="MÃ­nimo 8 caracteres">
                </div>

                <div id="loginError" class="error-message"></div>

                <button type="submit" class="btn-primary">Iniciar SesiÃ³n</button>
            </form>

            <p class="auth-link">
                Â¿No tienes cuenta? <a href="#" onclick="showRegister()">RegÃ­strate aquÃ­</a>
            </p>

            <div class="auth-footer">
                <p>Â© 2024 Jordan's</p>
            </div>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="auth-screen" style="display: none;">
        <div class="auth-container">
            <div class="auth-logo">ğŸ’°</div>
            <h1 class="auth-title">Crear Cuenta</h1>
            <p class="auth-subtitle">Completa tus datos</p>

            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Nombres Completos</label>
                    <input type="text" id="regNombres" required placeholder="Ej: Jordan Alejandro" oninput="generateUsername()">
                </div>

                <div class="form-group">
                    <label>Apellidos Completos</label>
                    <input type="text" id="regApellidos" required placeholder="Ej: Morales Vasquez" oninput="generateUsername()">
                </div>

                <div class="form-group">
                    <label>Fecha de Nacimiento</label>
                    <input type="date" id="regFechaNac" required oninput="generateUsername()">
                </div>

                <div class="form-group">
                    <label>Usuario (generado automÃ¡ticamente)</label>
                    <input type="text" id="regUsername" readonly placeholder="Se generarÃ¡ automÃ¡ticamente">
                </div>

                <div class="form-group">
                    <label>Correo ElectrÃ³nico</label>
                    <input type="email" id="regEmail" required placeholder="ejemplo@correo.com">
                </div>

                <div class="form-group">
                    <label>ContraseÃ±a</label>
                    <input type="password" id="regPassword" required placeholder="MÃ­nimo 8 caracteres, incluir nÃºmeros" oninput="validatePassword()">
                    <small id="passwordStrength" class="password-strength"></small>
                </div>

                <div class="form-group">
                    <label>Confirmar ContraseÃ±a</label>
                    <input type="password" id="regPasswordConfirm" required placeholder="Repite tu contraseÃ±a">
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="regTerms" required>
                        Acepto los <a href="#" onclick="showTerms()">tÃ©rminos y polÃ­ticas de Jordan's</a>
                    </label>
                </div>

                <div id="registerError" class="error-message"></div>

                <button type="submit" class="btn-primary">Crear Cuenta</button>
            </form>

            <p class="auth-link">
                Â¿Ya tienes cuenta? <a href="#" onclick="showLogin()">Inicia sesiÃ³n aquÃ­</a>
            </p>

            <div class="auth-footer">
                <p>Â© 2024 Jordan's</p>
            </div>
        </div>
    </div>

    <!-- App Container -->
    <div id="app" class="app" style="display: none;">
        
        <!-- Header -->
        <header class="header">
            <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
            <h1 class="header-title">ğŸ’° Mis Finanzas</h1>
            <div class="header-actions">
                <button class="theme-btn" onclick="toggleTheme()" title="Cambiar Tema">ğŸŒ™</button>
                <button class="logout-btn" onclick="handleLogout()" title="Cerrar SesiÃ³n">ğŸšª</button>
            </div>
        </header>

        <!-- Side Menu -->
        <div id="sideMenu" class="side-menu">
            <div class="menu-header">
                <h2>ğŸ’° MenÃº</h2>
                <button class="close-menu" onclick="toggleMenu()">âœ•</button>
            </div>
            <nav class="menu-nav">
                <button onclick="showScreen('home')">ğŸ  Inicio</button>
                <button onclick="showScreen('add')">â• Agregar TransacciÃ³n</button>
                <button onclick="showScreen('budget')">ğŸ’° Presupuestos</button>
                <button onclick="showScreen('stats')">ğŸ“Š EstadÃ­sticas</button>
                <button onclick="showScreen('googleSheets')">ğŸ“Š Google Sheets</button>
                <button onclick="exportData()">ğŸ“¥ Exportar Datos</button>
                <button onclick="clearData()">ğŸ—‘ï¸ Limpiar Datos</button>
            </nav>
        </div>

        <!-- Overlay -->
        <div id="overlay" class="overlay" onclick="toggleMenu()"></div>

        <!-- Home Screen -->
        <div id="homeScreen" class="screen active">
            <div class="summary-cards">
                <div class="card card-green">
                    <div class="card-icon">ğŸ’µ</div>
                    <div class="card-content">
                        <p class="card-label">Ingresos</p>
                        <p class="card-value" id="totalIngresos">S/. 0.00</p>
                    </div>
                </div>

                <div class="card card-red">
                    <div class="card-icon">ğŸ’¸</div>
                    <div class="card-content">
                        <p class="card-label">Gastos</p>
                        <p class="card-value" id="totalGastos">S/. 0.00</p>
                    </div>
                </div>

                <div class="card card-blue">
                    <div class="card-icon">ğŸ’°</div>
                    <div class="card-content">
                        <p class="card-label">Balance</p>
                        <p class="card-value" id="balance">S/. 0.00</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Transacciones Recientes</h2>
                <div id="transactionsList" class="transactions-list">
                    <!-- Transactions will be inserted here -->
                </div>
            </div>

            <button class="fab" onclick="showScreen('add')">
                â•
            </button>
        </div>

        <!-- Add Transaction Screen -->
        <div id="addScreen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="showScreen('home')">â† Volver</button>
                <h2>Nueva TransacciÃ³n</h2>
            </div>

            <div class="form-container">
                <div class="type-selector">
                    <button class="type-btn active" data-type="Gasto" onclick="selectType('Gasto')">
                        ğŸ’¸ Gasto
                    </button>
                    <button class="type-btn" data-type="Ingreso" onclick="selectType('Ingreso')">
                        ğŸ’µ Ingreso
                    </button>
                </div>

                <form id="transactionForm" onsubmit="saveTransaction(event)">
                    <div class="form-group">
                        <label>Monto (S/.)</label>
                        <input type="number" id="monto" step="0.01" required placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label>CategorÃ­a</label>
                        <select id="categoria" required>
                            <option value="">Selecciona una categorÃ­a</option>
                            <option value="AlimentaciÃ³n">ğŸ” AlimentaciÃ³n</option>
                            <option value="Transporte">ğŸš— Transporte</option>
                            <option value="Vivienda">ğŸ  Vivienda</option>
                            <option value="Servicios">ğŸ’¡ Servicios</option>
                            <option value="Entretenimiento">ğŸ® Entretenimiento</option>
                            <option value="Salud">ğŸ’Š Salud</option>
                            <option value="EducaciÃ³n">ğŸ“š EducaciÃ³n</option>
                            <option value="Otros">ğŸ“¦ Otros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>DescripciÃ³n</label>
                        <input type="text" id="descripcion" placeholder="Ej: Almuerzo en restaurante">
                    </div>

                    <button type="submit" class="btn-primary">
                        ğŸ’¾ Guardar TransacciÃ³n
                    </button>
                </form>
            </div>
        </div>

        <!-- Budget Screen -->
        <div id="budgetScreen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="showScreen('home')">â† Volver</button>
                <h2>Presupuestos</h2>
            </div>

            <div id="budgetList" class="budget-list">
                <!-- Budget items will be inserted here -->
            </div>
        </div>

        <!-- Stats Screen -->
        <div id="statsScreen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="showScreen('home')">â† Volver</button>
                <h2>EstadÃ­sticas</h2>
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <h3>Gastos por CategorÃ­a</h3>
                    <div id="categoryStats"></div>
                </div>

                <div class="stat-card">
                    <h3>Ãšltimos 7 dÃ­as</h3>
                    <div id="weekStats"></div>
                </div>
            </div>
        </div>

        <!-- Google Sheets Screen -->
        <div id="googleSheetsScreen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="showScreen('home')">â† Volver</button>
                <h2>Google Sheets</h2>
            </div>

            <div class="form-container">
                <div class="info-card">
                    <h3>ğŸ“Š Tu Excel Personal en la Nube</h3>
                    <p>Conecta tu cuenta de Google para crear y sincronizar tu archivo de finanzas en Google Sheets.</p>
                </div>

                <div id="googleNotAuthorized" class="google-auth-section">
                    <div class="auth-status">
                        <span class="status-icon">ğŸ”’</span>
                        <p>No has autorizado el acceso a Google Sheets</p>
                    </div>
                    <button onclick="handleGoogleAuthorization()" class="btn-primary">
                        ğŸ”‘ Autorizar Google Sheets
                    </button>
                    <p class="help-text">
                        Al autorizar, podremos crear un archivo Excel en tu Google Drive y sincronizar tus transacciones automÃ¡ticamente.
                    </p>
                </div>

                <div id="googleAuthorized" class="google-auth-section" style="display: none;">
                    <div class="auth-status success">
                        <span class="status-icon">âœ…</span>
                        <p>Google Sheets conectado</p>
                    </div>

                    <div class="google-actions">
                        <button onclick="handleSyncToSheets()" class="btn-primary">
                            â˜ï¸ Sincronizar a Google Sheets
                        </button>
                        <button onclick="handleImportFromSheets()" class="btn-secondary">
                            ğŸ“¥ Importar desde Google Sheets
                        </button>
                        <button onclick="openUserSpreadsheet()" class="btn-secondary">
                            ğŸ“Š Abrir mi Excel
                        </button>
                        <button onclick="handleRevokeGoogle()" class="btn-danger">
                            ğŸ”“ Revocar Acceso
                        </button>
                    </div>

                    <div class="info-card">
                        <h4>â„¹ï¸ InformaciÃ³n</h4>
                        <p id="spreadsheetInfo">Cargando informaciÃ³n...</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Footer -->
    <footer class="app-footer">
        <p>Â© 2024 Jordan's - Todos los derechos reservados</p>
    </footer>

    <!-- Terms Modal -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeTerms()">&times;</span>
            <h2>TÃ©rminos y PolÃ­ticas de Jordan's</h2>
            <div class="terms-content">
                <h3>1. AceptaciÃ³n de TÃ©rminos</h3>
                <p>Al usar Finanzas App, aceptas estos tÃ©rminos y condiciones.</p>
                
                <h3>2. Privacidad de Datos</h3>
                <p>Tus datos financieros son privados y se almacenan localmente en tu dispositivo.</p>
                
                <h3>3. Uso Responsable</h3>
                <p>Eres responsable de mantener la seguridad de tu cuenta y contraseÃ±a.</p>
                
                <h3>4. LimitaciÃ³n de Responsabilidad</h3>
                <p>Jordan's no se hace responsable por pÃ©rdidas financieras derivadas del uso de la app.</p>
                
                <h3>5. Modificaciones</h3>
                <p>Nos reservamos el derecho de modificar estos tÃ©rminos en cualquier momento.</p>
                
                <h3>6. Contacto</h3>
                <p>Para consultas: contacto@jordans.com</p>
            </div>
            <button onclick="closeTerms()" class="btn-primary">Entendido</button>
        </div>
    </div>

    <!-- Google API Scripts -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- App Scripts -->
    <script src="firebase-config.js"></script>
    <script src="firebase-auth.js"></script>
    <script src="google-sheets.js"></script>
    <script src="app.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1f36">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Finanzas">
    
    <title>ğŸ’° Finanzas App</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css?v=4.0">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Cargando...</p>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="auth-screen" style="display: none;">
        <div class="auth-container">
            <div class="auth-logo">ğŸ’°</div>
            <h1 class="auth-title">Finanzas App</h1>
            <p class="auth-subtitle">Inicia sesiÃ³n para continuar</p>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Usuario o Email</label>
                    <input type="text" id="loginUsername" required placeholder="Ej: jmorales07 o tu@email.com">
                </div>

                <div class="form-group">
                    <label>ContraseÃ±a</label>
                    <input type="password" id="loginPassword" required placeholder="MÃ­nimo 8 caracteres">
                </div>

                <div id="loginError" class="error-message"></div>

                <button type="submit" class="btn-primary">Iniciar SesiÃ³n</button>
            </form>

            <p class="auth-link">
                Â¿No tienes cuenta? <a href="#" onclick="showRegister()">RegÃ­strate aquÃ­</a>
            </p>

            <div class="auth-footer">
                <p>Â© 2024 Jordan's</p>
            </div>
        </div>
    </div>

    <!-- Email Verification Screen -->
    <div id="verificationScreen" class="auth-screen" style="display: none;">
        <div class="auth-container">
            <div class="auth-logo">ğŸ“§</div>
            <h1 class="auth-title">Verifica tu Correo</h1>
            <p class="auth-subtitle">Hemos enviado un cÃ³digo de verificaciÃ³n a tu correo</p>

            <div class="verification-info">
                <p><strong id="verificationEmail"></strong></p>
                <p style="margin-top: 10px; font-size: 14px; color: var(--text-secondary);">
                    Revisa tu bandeja de entrada y haz clic en el enlace de verificaciÃ³n.
                </p>
            </div>

            <div class="verification-actions">
                <button onclick="checkEmailVerification()" class="btn-primary">
                    âœ… Ya VerifiquÃ© mi Correo
                </button>
                
                <button onclick="resendVerificationEmail()" class="btn-secondary">
                    ğŸ“§ Reenviar CÃ³digo
                </button>
                
                <button onclick="showLogin()" class="btn-link">
                    â† Volver al Login
                </button>
            </div>

            <div class="auth-footer">
                <p>Â© 2024 Jordan's</p>
            </div>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="auth-screen" style="display: none;">
        <div class="auth-container">
            <div class="auth-logo">ğŸ’°</div>
            <h1 class="auth-title">Crear Cuenta</h1>
            <p class="auth-subtitle">Completa tus datos</p>

            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Nombres Completos</label>
                    <input type="text" id="regNombres" required placeholder="Ej: Jordan Alejandro" oninput="generateUsername()">
                </div>

                <div class="form-group">
                    <label>Apellidos Completos</label>
                    <input type="text" id="regApellidos" required placeholder="Ej: Morales Vasquez" oninput="generateUsername()">
                </div>

                <div class="form-group">
                    <label>Fecha de Nacimiento</label>
                    <input type="date" id="regFechaNac" required oninput="generateUsername()">
                </div>

                <div class="form-group">
                    <label>Usuario (sugerido, puedes editarlo)</label>
                    <input type="text" id="regUsername" placeholder="Se generarÃ¡ automÃ¡ticamente" minlength="4" maxlength="20">
                    <small style="color: var(--text-secondary); font-size: 12px;">
                        ğŸ’¡ Sugerencia automÃ¡tica. Puedes cambiarlo si lo deseas.
                    </small>
                </div>

                <div class="form-group">
                    <label>Correo ElectrÃ³nico</label>
                    <input type="email" id="regEmail" required placeholder="ejemplo@correo.com">
                </div>

                <div class="form-group">
                    <label>ContraseÃ±a</label>
                    <input type="password" id="regPassword" required placeholder="MÃ­nimo 8 caracteres, incluir nÃºmeros" oninput="validatePassword()">
                    <small id="passwordStrength" class="password-strength"></small>
                </div>

                <div class="form-group">
                    <label>Confirmar ContraseÃ±a</label>
                    <input type="password" id="regPasswordConfirm" required placeholder="Repite tu contraseÃ±a">
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="regTerms" required>
                        Acepto los <a href="#" onclick="showTerms()">tÃ©rminos y polÃ­ticas de Jordan's</a>
                    </label>
                </div>

                <div id="registerError" class="error-message"></div>

                <button type="submit" class="btn-primary">Crear Cuenta</button>
            </form>

            <p class="auth-link">
                Â¿Ya tienes cuenta? <a href="#" onclick="showLogin()">Inicia sesiÃ³n aquÃ­</a>
            </p>

            <div class="auth-footer">
                <p>Â© 2024 Jordan's</p>
            </div>
        </div>
    </div>

    <!-- App Container -->
    <div id="app" class="app" style="display: none;">
        
        <!-- Header -->
        <header class="header">
            <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
            <h1 class="header-title">ğŸ’° Mis Finanzas</h1>
            <div class="header-actions">
                <button class="theme-btn" onclick="toggleTheme()" title="Cambiar Tema">ğŸŒ™</button>
                <button class="logout-btn" onclick="handleLogout()" title="Cerrar SesiÃ³n">ğŸšª</button>
            </div>
        </header>

        <!-- Side Menu -->
        <div id="sideMenu" class="side-menu">
            <div class="menu-header">
                <h2>ğŸ’° MenÃº</h2>
                <button class="close-menu" onclick="toggleMenu()">âœ•</button>
            </div>
            <nav class="menu-nav">
                <button onclick="showScreen('home')">ğŸ  Inicio</button>
                <button onclick="showScreen('add')">â• Agregar TransacciÃ³n</button>
                <button onclick="showScreen('budget')">ğŸ’° Presupuestos</button>
                <button onclick="showScreen('stats')">ğŸ“Š EstadÃ­sticas</button>
                <button onclick="exportData()">ğŸ“¥ Exportar Datos</button>
                <button onclick="clearData()">ğŸ—‘ï¸ Limpiar Datos</button>
            </nav>
        </div>

        <!-- Overlay -->
        <div id="overlay" class="overlay" onclick="toggleMenu()"></div>

        <!-- Home Screen -->
        <div id="homeScreen" class="screen active">
            <div class="summary-cards">
                <div class="card card-green">
                    <div class="card-icon">ğŸ’µ</div>
                    <div class="card-content">
                        <p class="card-label">Ingresos</p>
                        <p class="card-value" id="totalIngresos">S/. 0.00</p>
                    </div>
                </div>

                <div class="card card-red">
                    <div class="card-icon">ğŸ’¸</div>
                    <div class="card-content">
                        <p class="card-label">Gastos</p>
                        <p class="card-value" id="totalGastos">S/. 0.00</p>
                    </div>
                </div>

                <div class="card card-blue">
                    <div class="card-icon">ğŸ’°</div>
                    <div class="card-content">
                        <p class="card-label">Balance</p>
                        <p class="card-value" id="balance">S/. 0.00</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Transacciones Recientes</h2>
                <div id="transactionsList" class="transactions-list">
                    <!-- Transactions will be inserted here -->
                </div>
                <button id="verMasBtn" class="btn-ver-mas" onclick="showAllTransactions()" style="display: none;">
                    ğŸ‘ï¸ Ver MÃ¡s Transacciones
                </button>
            </div>

            <button class="fab" onclick="showScreen('add')">
                â•
            </button>
        </div>

        <!-- Add Transaction Screen -->
        <div id="addScreen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="showScreen('home')">â† Volver</button>
                <h2>Nueva TransacciÃ³n</h2>
            </div>

            <div class="form-container">
                <div class="type-selector">
                    <button class="type-btn active" data-type="Gasto" onclick="selectType('Gasto')">
                        ğŸ’¸ Gasto
                    </button>
                    <button class="type-btn" data-type="Ingreso" onclick="selectType('Ingreso')">
                        ğŸ’µ Ingreso
                    </button>
                </div>

                <form id="transactionForm" onsubmit="saveTransaction(event)">
                    <div class="form-group">
                        <label>Monto (S/.)</label>
                        <input type="number" id="monto" step="0.01" required placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label>CategorÃ­a</label>
                        <select id="categoria" required>
                            <option value="">Selecciona una categorÃ­a</option>
                            <option value="AlimentaciÃ³n">ğŸ” AlimentaciÃ³n</option>
                            <option value="Transporte">ğŸš— Transporte</option>
                            <option value="Vivienda">ğŸ  Vivienda</option>
                            <option value="Servicios">ğŸ’¡ Servicios</option>
                            <option value="Entretenimiento">ğŸ® Entretenimiento</option>
                            <option value="Salud">ğŸ’Š Salud</option>
                            <option value="EducaciÃ³n">ğŸ“š EducaciÃ³n</option>
                            <option value="Otros">ğŸ“¦ Otros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>DescripciÃ³n</label>
                        <input type="text" id="descripcion" placeholder="Ej: Almuerzo en restaurante">
                    </div>

                    <div class="form-group">
                        <label>Comprobante (Opcional)</label>
                        <div class="file-input-container">
                            <input type="file" id="comprobante" accept="image/*" onchange="previewImage(event)" class="file-input-hidden">
                            <button type="button" class="file-input-btn" onclick="document.getElementById('comprobante').click()">
                                ğŸ“¸ Seleccionar Archivo
                            </button>
                            <span id="fileName" class="file-name">NingÃºn archivo seleccionado</span>
                        </div>
                        <small style="color: var(--text-secondary); font-size: 12px;">
                            ğŸ“¸ Puedes adjuntar una foto del comprobante o transferencia
                        </small>
                        <div id="imagePreview" class="image-preview"></div>
                    </div>

                    <button type="submit" class="btn-primary">
                        ğŸ’¾ Guardar TransacciÃ³n
                    </button>
                </form>
            </div>
        </div>

        <!-- Budget Screen -->
        <div id="budgetScreen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="showScreen('home')">â† Volver</button>
                <h2>Presupuestos</h2>
            </div>

            <div id="budgetList" class="budget-list">
                <!-- Budget items will be inserted here -->
            </div>
        </div>

        <!-- Stats Screen -->
        <div id="statsScreen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="showScreen('home')">â† Volver</button>
                <h2>EstadÃ­sticas</h2>
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <h3>Gastos por CategorÃ­a</h3>
                    <div id="categoryStats"></div>
                </div>

                <div class="stat-card">
                    <h3>Ãšltimos 7 dÃ­as</h3>
                    <div id="weekStats"></div>
                </div>
            </div>
        </div>

        <!-- All Transactions Screen -->
        <div id="allTransactionsScreen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="showScreen('home')">â† Volver</button>
                <h2>Todas las Transacciones</h2>
            </div>

            <div class="transactions-container">
                <div id="allTransactionsList" class="transactions-list">
                    <!-- All transactions will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Edit Transaction Screen -->
        <div id="editTransactionScreen" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="cancelEditTransaction()">â† Cancelar</button>
                <h2>Editar TransacciÃ³n</h2>
            </div>

            <div class="form-container">
                <div class="type-selector">
                    <button class="type-btn" data-type="Gasto" onclick="selectEditType('Gasto')">
                        ğŸ’¸ Gasto
                    </button>
                    <button class="type-btn" data-type="Ingreso" onclick="selectEditType('Ingreso')">
                        ğŸ’µ Ingreso
                    </button>
                </div>

                <form id="editTransactionForm" onsubmit="updateTransaction(event)">
                    <input type="hidden" id="editTransactionId">
                    
                    <div class="form-group">
                        <label>Monto (S/.)</label>
                        <input type="number" id="editMonto" step="0.01" required placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label>CategorÃ­a</label>
                        <select id="editCategoria" required>
                            <option value="">Selecciona una categorÃ­a</option>
                            <option value="AlimentaciÃ³n">ğŸ” AlimentaciÃ³n</option>
                            <option value="Transporte">ğŸš— Transporte</option>
                            <option value="Vivienda">ğŸ  Vivienda</option>
                            <option value="Servicios">ğŸ’¡ Servicios</option>
                            <option value="Entretenimiento">ğŸ® Entretenimiento</option>
                            <option value="Salud">ğŸ’Š Salud</option>
                            <option value="EducaciÃ³n">ğŸ“š EducaciÃ³n</option>
                            <option value="Otros">ğŸ“¦ Otros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>DescripciÃ³n</label>
                        <input type="text" id="editDescripcion" placeholder="Ej: Almuerzo en restaurante">
                    </div>

                    <div class="form-group">
                        <label>Comprobante (Opcional)</label>
                        <div class="file-input-container">
                            <input type="file" id="editComprobante" accept="image/*" onchange="previewEditImage(event)" class="file-input-hidden">
                            <button type="button" class="file-input-btn" onclick="document.getElementById('editComprobante').click()">
                                ğŸ“¸ Seleccionar Archivo
                            </button>
                            <span id="editFileName" class="file-name">NingÃºn archivo seleccionado</span>
                        </div>
                        <small style="color: var(--text-secondary); font-size: 12px;">
                            ğŸ“¸ Puedes cambiar o agregar una foto del comprobante
                        </small>
                        <div id="editImagePreview" class="image-preview"></div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            ğŸ’¾ Guardar Cambios
                        </button>
                        <button type="button" class="btn-danger" onclick="confirmDeleteTransaction()">
                            ğŸ—‘ï¸ Eliminar TransacciÃ³n
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Footer -->
    <footer class="app-footer">
        <p>Â© 2024 Jordan's - Todos los derechos reservados</p>
    </footer>

    <!-- Terms Modal -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeTerms()">&times;</span>
            <h2>TÃ©rminos y PolÃ­ticas de Jordan's</h2>
            <div class="terms-content">
                <h3>1. AceptaciÃ³n de TÃ©rminos</h3>
                <p>Al usar Finanzas App, aceptas estos tÃ©rminos y condiciones.</p>
                
                <h3>2. Privacidad de Datos</h3>
                <p>Tus datos financieros son privados y se almacenan localmente en tu dispositivo.</p>
                
                <h3>3. Uso Responsable</h3>
                <p>Eres responsable de mantener la seguridad de tu cuenta y contraseÃ±a.</p>
                
                <h3>4. LimitaciÃ³n de Responsabilidad</h3>
                <p>Jordan's no se hace responsable por pÃ©rdidas financieras derivadas del uso de la app.</p>
                
                <h3>5. Modificaciones</h3>
                <p>Nos reservamos el derecho de modificar estos tÃ©rminos en cualquier momento.</p>
                
                <h3>6. Contacto</h3>
                <p>Para consultas: contacto@jordans.com</p>
            </div>
            <button onclick="closeTerms()" class="btn-primary">Entendido</button>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- App Scripts -->
    <script src="firebase-config.js?v=4.0"></script>
    <script src="firebase-auth.js?v=4.0"></script>
    <script src="app.js?v=4.0"></script>
</body>
</html>
